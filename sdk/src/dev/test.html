<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<script type="text/ng-template" id="page1.html">
    <h1>Page1</h1>
</script>
<script type="text/ng-template" id="page2.html">
    <h1>Page2</h1>
</script>

<ul>
    <li><a href="#/page1">page1</a></li>
    <li><a href="#/page2">page2</a></li>
</ul>

<ng-view></ng-view>

<script type="text/javascript" src="../bower_components/angular/angular.js"></script>
<script type="text/javascript" src="../bower_components/angular-route/angular-route.js"></script>
<script>

    angular.module('webapp', ['ngRoute'])

            .config(function ($routeProvider) {
                $routeProvider
                        .when('/page1', {
                            templateUrl: 'page1.html',
                            controller: 'Page1Controller'
                        })
                        .when('/page2', {
                            templateUrl: 'page2.html',
                            controller: 'Page2Controller'
                        })
            })

            .run(function ($rootScope, $interval, $timeout) {
                window.$timeouts = [];
                window.$intervals = [];

                /* 检测路由变化的时候清除timer */
                $rootScope.$on('$locationChangeStart', function (event, url) {
                    for (var i in window.$timeouts) {
                        try {
                            $timeout.cancel(window.$timeouts[i]);
                        } catch (err) {
                            console.info(err);
                        }
                    }

                    for (var j in window.$intervals) {
                        try {
                            $interval.cancel(window.$intervals[j]);
                        } catch (err) {
                            console.info(err);
                        }
                    }

                    window.$timeouts = [];
                    window.$intervals = [];
                });
            })

            .controller('Page1Controller', function ($timeout, $interval) {
                var timeout = $timeout(function () {
                    console.info('page1 $timeout');
                }, 2000);
                var interval = $interval(function () {
                    console.info('page1 $interval');
                }, 3000);

                window.$timeouts.push(timeout);
                window.$intervals.push(interval);
            })

            .controller('Page2Controller', function ($timeout, $interval) {
                var timeout = $timeout(function () {
                    console.info('page2 $timeout');
                }, 2000);
                var interval = $interval(function () {
                    console.info('page2 $interval');
                }, 3000);

                window.$timeouts.push(timeout);
                window.$intervals.push(interval);
            })

    angular.bootstrap(document, ['webapp']);
</script>


</body>
</html>